@using jinx_debt_tracker.Services
@using Microsoft.AspNetCore.Components
@inject ThemeService ThemeService
@inject NavigationManager Navigation
@inherits IgnisAsyncComponentBase
@implements IDisposable

<div class="min-h-screen bg-gray-50 dark:bg-gray-950 transition-colors duration-200">
    <div class="flex flex-col min-h-screen">
        <!-- Header -->
        <header class="sticky top-0 z-50 w-full border-b border-gray-200 dark:border-gray-900 bg-white/80 dark:bg-gray-950/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-gray-950/60">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 items-center justify-between">
                    <div class="flex items-center gap-8">
                        <h1 class="text-xl font-semibold text-gray-900 dark:text-white">
                            Jinx Score Tracker
                        </h1>
                        <nav class="flex items-center">
                            @if (IsOnRulesPage)
                            {
                                <a href="/" class="text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors">
                                    Home
                                </a>
                            }
                            else
                            {
                                <a href="/rules" class="text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors">
                                    Rules
                                </a>
                            }
                        </nav>
                    </div>
                    <div class="flex items-center gap-4">
                        <ThemeToggle />
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1">
            @Body
        </main>
    </div>
</div>

@code
{
    [Parameter] public RenderFragment? Body { get; set; }

    private bool IsOnRulesPage => Navigation.Uri.EndsWith("/rules") || Navigation.Uri.Contains("/rules");

    protected override async Task OnInitializedAsync(CancellationToken cancellationToken)
    {
        ThemeService.OnThemeChanged += OnThemeChanged;
        Navigation.LocationChanged += OnLocationChanged;
        await ThemeService.InitializeAsync();
        Update();
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        Update();
    }

    private void OnThemeChanged()
    {
        Update();
    }

    public void Dispose()
    {
        ThemeService.OnThemeChanged -= OnThemeChanged;
        Navigation.LocationChanged -= OnLocationChanged;
    }
}